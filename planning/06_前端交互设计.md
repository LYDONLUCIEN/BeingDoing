# 前端交互设计

## 一、页面结构

### 1.1 主要页面

```
首页 (Home)
  │
  ├─── 注册/登录页 (Auth)
  │      │
  │      ├─── 注册表单
  │      └─── 登录表单
  │
  ├─── 用户信息收集页 (Profile)
  │      │
  │      ├─── 基本信息（性别、年龄）
  │      └─── 工作履历（详细输入）
  │
  ├─── 探索流程页 (Explore) ──── 主要交互页面
  │      │
  │      ├─── 步骤引导区
  │      ├─── 问题展示区
  │      ├─── 回答输入区
  │      ├─── 对话助手区
  │      ├─── 默认引导问题区
  │      └─── 进度展示区
  │
  └─── 结果页 (Result)
         │
         ├─── 结果摘要
         ├─── 详细分析
         └─── 导出功能（PDF/JSON/Markdown三选一）
```

### 1.2 页面布局

```
┌─────────────────────────────────────────────────┐
│  顶部导航栏                                      │
│  [Logo] [进度] [帮助] [设置]                    │
├─────────────────────────────────────────────────┤
│                                                  │
│  ┌──────────────┐  ┌──────────────────────────┐ │
│  │              │  │                          │ │
│  │  步骤引导区   │  │    问题展示区             │ │
│  │              │  │                          │ │
│  │  [步骤1] ✓   │  │  ┌────────────────────┐ │ │
│  │  [步骤2] →   │  │  │  问题内容           │ │ │
│  │  [步骤3] ○   │  │  └────────────────────┘ │ │
│  │              │  │                          │ │
│  └──────────────┘  │  ┌────────────────────┐ │ │
│                    │  │  回答输入区          │ │ │
│  ┌──────────────┐  │  │                    │ │ │
│  │              │  │  │  [文本输入框]       │ │ │
│  │  对话助手区   │  │  │  [语音输入] [提交]  │ │ │
│  │              │  │  └────────────────────┘ │ │
│  │  [AI助手]     │  │                          │ │
│  │  ┌──────────┐ │  │  ┌────────────────────┐ │ │
│  │  │ 对话消息  │ │  │  │  回答历史           │ │ │
│  │  └──────────┘ │  │  └────────────────────┘ │ │
│  └──────────────┘  └──────────────────────────┘ │
│                                                  │
└─────────────────────────────────────────────────┘
```

## 二、核心组件设计

### 2.1 步骤引导组件 (StepGuide)

```tsx
interface StepGuideProps {
  currentStep: string;
  steps: Step[];
  onStepClick: (step: string) => void;
}

// 功能：
// - 显示当前步骤
// - 显示已完成步骤（✓）
// - 显示下一步骤（→）
// - 显示未开始步骤（○）
// - 点击切换步骤（如果允许）
```

**视觉设计**：
- 垂直时间线样式
- 当前步骤高亮
- 已完成步骤绿色
- 未开始步骤灰色

### 2.2 问题卡片组件 (QuestionCard)

```tsx
interface QuestionCardProps {
  question: Question;
  answer?: Answer;
  onAnswerChange: (answer: string) => void;
  onConceptClick: (concept: string) => void;
}

// 功能：
// - 显示问题标题和内容
// - 高亮显示可点击的概念（悬停显示提示）
// - 显示提示信息
// - 显示相关示例（可选）
// - 支持选中文本进行问答
```

**交互设计**：
- 概念词高亮（蓝色下划线）
- 悬停显示概念解释（Tooltip）
- 点击概念弹出详细解释
- 选中文本显示"询问"按钮

### 2.3 回答输入组件 (AnswerInput)

```tsx
interface AnswerInputProps {
  questionId: number;
  value: string;
  onChange: (value: string) => void;
  onSubmit: () => void;
  onVoiceInput?: () => void;
  placeholder?: string;
  minLength?: number;
  maxLength?: number;
}

// 功能：
// - 多行文本输入
// - 字数统计
// - 自动保存（防丢失）
// - 语音输入（可选）
// - 提交按钮
// - 输入提示
```

**交互设计**：
- 自动保存（每30秒或失焦时）
- 字数提示（如：150/500字）
- 提交前确认（如果回答过短）
- 语音输入按钮（P2功能）

### 2.4 默认引导问题组件 (GuideQuestions)

```tsx
interface GuideQuestionsProps {
  step: string;
  category?: string;
  onQuestionClick: (question: GuideQuestion) => void;
  audioMode: boolean;  // AUDIO_MODE配置
}

// 功能：
// - 显示当前步骤的默认引导问题
// - 快速点选引导问题
// - 根据AUDIO_MODE显示/隐藏语音按钮
// - 问题类型：概念询问、示例请求、困惑表达等
```

**交互设计**：
- 按钮组样式
- 点击后自动发送到对话助手
- 根据AUDIO_MODE控制语音按钮显示
- 不同步骤显示不同引导问题

### 2.5 用户信息收集组件 (UserProfileForm)

```tsx
interface UserProfileFormProps {
  onSubmit: (profile: UserProfile) => void;
  initialData?: UserProfile;
}

// 功能：
// - 收集性别、年龄
// - 收集工作履历（多段经历）
// - 每段经历包含：公司、职位、时间、项目、成就、评价
// - 支持添加/删除工作经历
// - 大量文本输入区域
```

**交互设计**：
- 表单分步骤填写
- 工作履历可动态添加
- 项目经历嵌套在工作履历中
- 自动保存草稿

### 2.6 对话助手组件 (ChatInterface)

```tsx
interface ChatInterfaceProps {
  sessionId: string;
  messages: Message[];
  onSendMessage: (message: string) => void;
  onSelectText?: (text: string) => void;
}

// 功能：
// - 显示对话历史
// - 发送消息
// - 选中文本询问
// - 显示AI建议
// - 显示相关推荐
```

**交互设计**：
- 消息气泡样式
- 用户消息在右侧（蓝色）
- AI消息在左侧（灰色）
- 相关推荐显示在AI消息下方
- 支持滚动到底部

### 2.7 进度条组件 (ProgressBar)

```tsx
interface ProgressBarProps {
  currentStep: string;
  progress: {
    values: { completed: number; total: number };
    strengths: { completed: number; total: number };
    interests: { completed: number; total: number };
  };
}

// 功能：
// - 显示总体进度
// - 显示各步骤进度
// - 显示预计剩余时间
```

**视觉设计**：
- 环形进度条（总体）
- 条形进度条（各步骤）
- 百分比显示
- 预计时间显示

### 2.8 公式展示组件 (FormulaDisplay)

```tsx
interface FormulaDisplayProps {
  formula: "formula1" | "formula2";
  onElementClick?: (element: string) => void;
}

// 功能：
// - 可视化展示公式
// - 点击元素显示解释
// - 动画展示公式关系
```

**视觉设计**：
- 数学公式样式
- 元素可点击
- 悬停高亮
- 动画效果

## 三、交互流程

### 3.1 首次进入流程

```
1. 首页
   └─> 检查登录状态
       ├─> 未登录 → 注册/登录页
       └─> 已登录 → 检查信息收集
           ├─> 未完成 → 用户信息收集页
           └─> 已完成 → 检查探索进度
               ├─> 有进度 → 继续探索
               └─> 无进度 → 创建会话 → 进入探索流程页

2. 用户信息收集页
   └─> 填写基本信息（性别、年龄）
       └─> 填写工作履历（详细）
           └─> 提交 → 进入探索流程页

3. 探索流程页
   └─> 显示欢迎信息
       └─> 介绍公式
           └─> 开始第一步（价值观探索）
```

### 3.2 回答问题流程

```
1. 显示问题
   └─> 用户阅读问题
       └─> 用户输入回答
           ├─> 自动保存
           ├─> 用户困惑 → 点击概念/选中文本 → 询问AI
           └─> 用户完成 → 提交回答
               └─> 保存回答
                   └─> 显示下一个问题
```

### 3.3 概念询问流程

```
1. 用户点击概念词
   └─> 显示Tooltip（简要解释）
       └─> 用户点击"了解更多"
           └─> 打开概念详情弹窗
               └─> 显示详细解释和示例
```

### 3.4 选中文本询问流程

```
1. 用户选中文本
   └─> 显示"询问"按钮
       └─> 用户点击
           └─> 在对话助手区显示问题
               └─> AI回答
                   └─> 显示相关推荐
```

### 3.5 主动引导流程

```
1. 检测到触发条件（如：空闲10分钟）
   └─> 检查用户引导偏好
       ├─> normal → 10分钟提示
       └─> quiet → 15分钟提示
   └─> 显示引导提示（Toast/Modal）
       ├─> 显示默认引导问题（快速点选）
       ├─> 用户点击"继续"
       │   └─> 回到当前问题
       ├─> 用户点击"需要帮助"
       │   └─> 打开对话助手
       └─> 用户点击"让我安静"
           └─> 设置偏好为quiet → 改为15分钟提示
```

### 3.6 默认引导问题使用流程

```
1. 用户看到默认引导问题列表
   └─> 点击某个引导问题（如："这个问题是什么意思？"）
       └─> 自动发送到对话助手
           └─> AI回答
               └─> 显示在对话界面
```

## 四、状态管理

### 4.1 全局状态

```typescript
interface AppState {
  // 用户
  user: {
    id: string | null;
    email: string | null;
    profileCompleted: boolean;
    token: string | null;
  };
  
  // 会话
  session: {
    id: string | null;
    currentStep: string;
    status: "active" | "paused" | "completed";
  };
  
  // 进度
  progress: {
    values: Progress;
    strengths: Progress;
    interests: Progress;
  };
  
  // 当前问题
  currentQuestion: Question | null;
  
  // 当前回答
  currentAnswer: string;
  
  // 对话
  conversations: Message[];
  
  // 默认引导问题
  guideQuestions: GuideQuestion[];
  
  // 引导偏好
  guidePreference: "normal" | "quiet";
  
  // 配置
  config: {
    audioMode: boolean;  // AUDIO_MODE
  };
  
  // UI状态
  ui: {
    sidebarOpen: boolean;
    chatOpen: boolean;
    conceptModalOpen: boolean;
  };
}
```

### 4.2 状态更新流程

```
用户操作
  └─> 更新本地状态
      └─> 调用API
          └─> 更新服务器状态
              └─> 返回响应
                  └─> 更新本地状态
                      └─> UI更新
```

## 五、响应式设计

### 5.1 断点设置

```css
/* 移动端 */
@media (max-width: 768px) {
  /* 单列布局 */
  /* 步骤引导区折叠 */
  /* 对话助手区底部固定 */
}

/* 平板 */
@media (min-width: 769px) and (max-width: 1024px) {
  /* 两列布局 */
}

/* 桌面 */
@media (min-width: 1025px) {
  /* 三列布局 */
}
```

### 5.2 移动端优化

- 步骤引导区：可折叠，默认收起
- 对话助手区：底部固定，可展开/收起
- 问题卡片：全宽显示
- 回答输入：全宽，固定在底部

## 六、动画和过渡

### 6.1 页面过渡
- 步骤切换：淡入淡出
- 问题切换：滑动效果
- 弹窗：缩放+淡入

### 6.2 微交互
- 按钮悬停：轻微放大
- 输入框聚焦：边框高亮
- 消息发送：从下往上滑入
- 进度更新：数字递增动画

## 七、可访问性

### 7.1 键盘导航
- Tab键切换焦点
- Enter键提交
- Esc键关闭弹窗
- 方向键导航步骤

### 7.2 屏幕阅读器
- 语义化HTML
- ARIA标签
- 替代文本

### 7.3 颜色对比
- 符合WCAG AA标准
- 支持深色模式（可选）

## 八、性能优化

### 8.1 代码分割
```typescript
// 路由懒加载
const Explore = lazy(() => import('./pages/Explore'));
const Result = lazy(() => import('./pages/Result'));
```

### 8.2 虚拟滚动
- 对话历史列表
- 回答历史列表

### 8.3 缓存策略
- API响应缓存
- 问题列表缓存
- 概念解释缓存

## 九、错误处理

### 9.1 网络错误
- 显示友好错误提示
- 自动重试机制
- 离线提示

### 9.2 输入验证
- 实时验证
- 错误提示
- 防止重复提交

## 十、用户体验优化

### 10.1 加载状态
- 骨架屏
- 加载动画
- 进度提示

### 10.2 反馈机制
- 操作成功提示
- 自动保存提示
- 错误提示

### 10.3 引导提示
- 首次使用引导
- 功能提示
- 帮助文档
- 默认引导问题快速点选

### 10.4 语音功能控制
- 根据`AUDIO_MODE`配置控制
- `False`时：语音按钮不可点击，但位置保留
- `True`时：启用语音输入/输出
- 配置从后端API获取
