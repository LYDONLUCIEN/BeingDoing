# 智能体框架设计文档

## 文档索引

本目录包含完整的智能体框架设计文档，用于构建"找到想做的事"探索系统。

### 📋 文档列表

1. **[01_需求分析与澄清.md](./01_需求分析与澄清.md)**
   - 核心功能需求
   - 需要澄清的问题
   - 功能优先级
   - 用户体验要求

2. **[02_技术架构设计.md](./02_技术架构设计.md)**
   - 整体架构
   - 技术栈选择
   - 目录结构
   - 关键技术决策

3. **[03_API接口设计.md](./03_API接口设计.md)**
   - 接口规范
   - 完整API列表
   - 认证和限流
   - 响应格式

4. **[04_数据库设计.md](./04_数据库设计.md)**
   - 数据库选择
   - 数据表设计
   - 数据关系
   - 性能优化

5. **[05_智能体设计.md](./05_智能体设计.md)**
   - 智能体架构
   - 工作流程
   - LLM提示词设计
   - 知识库检索策略

6. **[06_前端交互设计.md](./06_前端交互设计.md)**
   - 页面结构
   - 核心组件
   - 交互流程
   - 响应式设计

7. **[07_系统流程图.md](./07_系统流程图.md)**
   - 用户探索流程
   - 智能问答流程
   - 主动引导流程
   - 其他关键流程

8. **[08_架构切换与模块接口设计.md](./08_架构切换与模块接口设计.md)**
   - 简化架构 vs 完整架构
   - 架构切换机制
   - 核心模块接口设计
   - ASR/TTS接口设计
   - 向量存储接口设计
   - 缓存和任务队列接口设计

9. **[todolist.md](./todolist.md)**
   - 详细开发任务清单
   - 开发阶段划分
   - 开发顺序建议
   - 风险评估
   - 测试策略
   - 里程碑规划

## 🎯 项目概述

### 核心目标
构建一个沉浸式的智能引导系统，帮助用户通过系统化的方法找到"真正想做的事"。

### 核心公式
- **公式1**：喜欢的事 × 擅长的事 = 想做的事
- **公式2**：喜欢的事 × 擅长的事 × 重要的事 = 真正想做的事

### 主要功能
1. **用户注册登录**：支持邮箱/手机号注册，保存所有探索记录
2. **用户信息收集**：注册后收集性别、年龄、详细工作履历，快速了解用户
3. **沉浸式引导**：按照流程图逐步完成探索
4. **智能问答**：提供精炼、针对性的指导（不超过200字）
5. **主动引导**：可配置的引导策略（10分钟/15分钟，根据用户偏好）
6. **默认引导问题**：快速点选的引导问题，不同步骤显示不同问题
7. **内容检索**：从知识库中检索相关内容（CSV + question.md）
8. **进度跟踪**：记录和展示探索进度，支持继续和重新开始
9. **数据导出**：支持PDF/JSON/Markdown三选一导出
10. **上下文管理**：保留扩展接口，便于后期优化算法

## 🏗️ 技术架构

### 前端
- **框架**：React + TypeScript
- **UI库**：Ant Design / Material-UI
- **状态管理**：Zustand
- **构建工具**：Vite
- **语音**：Web Speech API (AUDIO_MODE控制)

### 后端
- **框架**：FastAPI (Python)
- **数据库**：PostgreSQL (生产) / SQLite (开发)
- **ORM**：SQLAlchemy (async)
- **认证**：JWT Token

### AI/智能体
- **框架**：LangGraph + ReAct范式
- **LLM**：OpenAI API (GPT-4/GPT-3.5) + 本地模型降级
- **ASR**：OpenAI Whisper / 本地Whisper / Web Speech API
- **TTS**：OpenAI TTS / pyttsx3 / Google TTS
- **模块**：
  - LLM接入：`src/backend/app/core/llmapi/`
  - ASR接入：`src/backend/app/core/asr/`
  - TTS接入：`src/backend/app/core/tts/`
  - 智能体框架：`src/backend/app/core/agent/` (LangGraph)
- **检索**：关键词匹配 + 向量检索（可选）
- **上下文管理**：可扩展接口，当前直接拼接

### 部署
- **平台**：阿里云
- **方式**：Docker容器化部署
- **并发**：2-5用户（低并发）

## 📊 数据源

1. **重要的事_价值观.csv** - 100个价值观
2. **擅长的事_才能.csv** - 100个才能
3. **喜欢的事_热情.csv** - 100个兴趣领域
4. **question.md** - 90个探索问题

## 🔧 核心配置

### 环境变量
- `ARCHITECTURE_MODE`: 架构模式（simple/full，默认simple）
- `AUDIO_MODE`: 语音功能开关（True/False）
- `LLM_PROVIDER`: LLM提供商（openai/local）
- `ASR_PROVIDER`: ASR提供商（openai/local/web_speech）
- `TTS_PROVIDER`: TTS提供商（openai/pyttsx3/gtts）
- `GUIDE_IDLE_TIMEOUT`: 空闲超时时间（默认600秒/10分钟）
- `GUIDE_QUIET_TIMEOUT`: 安静模式超时时间（默认900秒/15分钟）
- `GUIDE_SHORT_ANSWER_THRESHOLD`: 回答过短阈值（默认20字）

### 模块化设计
- **LLM接入**：`src/backend/app/core/llmapi/` - 统一接口，多提供商支持
- **ASR接入**：`src/backend/app/core/asr/` - 统一接口，多提供商支持
- **TTS接入**：`src/backend/app/core/tts/` - 统一接口，多提供商支持
- **智能体框架**：`src/backend/app/core/agent/` - LangGraph + ReAct范式
- **知识检索**：`src/backend/app/core/knowledge/` - 支持简单/完整架构切换
- **数据库**：`src/backend/app/core/database/`（用户/历史/知识/向量分离）
- **异步服务**：`src/backend/app/core/async_service/` - 支持内存队列/Celery切换
- **缓存**：`src/backend/app/core/cache/` - 支持内存缓存/Redis切换
- **向量存储**：`src/backend/app/core/knowledge/vector/` - 支持内存/Chroma/FAISS切换
- **Tools/Actions/Skills**：独立模块，清晰拆分

### 架构切换
- **简化架构**：验证阶段，无外部依赖（Nginx、Chroma、Redis、Celery）
- **完整架构**：生产环境，所有外部依赖可选
- **切换方式**：全局配置 `ARCHITECTURE_MODE=simple|full`
- **原则**：所有模块提供统一接口，自动根据架构模式选择实现

## 🚀 开发计划

### Phase 1: MVP (核心功能) ✅
- [x] 用户注册登录
- [x] 用户信息收集（性别、年龄、工作履历）
- [x] 基础流程引导
- [x] 问题展示和回答收集
- [x] 文字问答功能
- [x] 基础数据存储
- [x] 内容检索（CSV和question.md）
- [x] 进度保存和恢复

### Phase 2: 增强功能
- [ ] 概念提示和解释
- [ ] 主动引导功能（可配置策略）
- [ ] 默认引导问题（快速点选）
- [ ] 回答历史展示
- [ ] 示例推荐
- [ ] 上下文管理（当前实现：直接拼接）

### Phase 3: 高级功能
- [ ] 语音输入/输出（AUDIO_MODE控制，预留接口）
- [ ] 数据导出（PDF/JSON/Markdown三选一）
- [ ] 可视化图表展示
- [ ] 分享功能
- [ ] 上下文管理算法优化

## 📝 下一步行动

1. **✅ 需求确认**：已完成需求分析和澄清
2. **✅ 技术选型**：已确定技术栈（React + FastAPI + PostgreSQL）
3. **✅ 架构设计**：已完成模块化架构设计
4. **环境搭建**：创建项目结构和开发环境
5. **数据库初始化**：创建数据表和初始化数据
6. **API开发**：实现核心API接口
7. **前端开发**：实现核心页面和组件
8. **智能体开发**：实现智能体框架和LLM接入
9. **测试迭代**：测试和优化

## 📋 设计文档更新说明

### 已更新内容
1. **用户注册登录**：方案B，支持邮箱/手机号
2. **用户信息收集**：注册后收集性别、年龄、详细工作履历
3. **数据存储**：存储所有进度、选择、结果
4. **对话记录**：使用JSON文件存储，分类存储（主流程/引导/澄清/其他），不存数据库表
5. **语音功能**：AUDIO_MODE配置控制，ASR/TTS独立接口设计
6. **智能体框架**：LangGraph + ReAct范式，成熟框架
7. **主动引导**：可配置策略，10分钟/15分钟（根据用户偏好）
8. **默认引导问题**：不同步骤显示不同引导问题，快速点选
9. **上下文管理**：保留扩展接口，当前直接拼接
10. **导出格式**：PDF/JSON/Markdown三选一
11. **部署环境**：阿里云 + Docker
12. **并发要求**：2-5用户（低并发）
13. **模块化设计**：所有模块清晰拆分和解耦
14. **架构切换**：简化架构（无外部依赖）vs 完整架构（保留接口，暂不实现）
15. **外部依赖管理**：Nginx、Chroma、Redis、Celery等保留接口，验证阶段不使用
16. **开发任务清单**：详细的todolist，包含开发顺序、风险评估、测试策略

## 🔗 相关文档

- [note_organized.md](../note_organized.md) - 笔记整理
- [flowchart.md](../flowchart.md) - 流程图说明
- [question.md](../question.md) - 问题清单

## 📧 联系方式

如有问题或建议，请通过以下方式联系：
- 项目Issue
- 邮件

---

**最后更新**：2024-01-01
**版本**：v1.0.0
