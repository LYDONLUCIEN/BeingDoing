# 需求分析与澄清

## 一、核心功能需求

### 1.1 沉浸式引导流程
- **目标**：让用户按照流程图逐步完成自我探索
- **要求**：
  - 清晰的步骤展示和进度跟踪
  - 每个步骤有明确的目标和说明
  - 支持前进、后退、暂停
  - 自动保存进度

### 2.2 公式理解与教育
- **目标**：帮助用户理解核心公式的重要性
- **公式**：
  - 公式1：喜欢的事 × 擅长的事 = 想做的事
  - 公式2：喜欢的事 × 擅长的事 × 重要的事 = 真正想做的事
- **要求**：
  - 可视化展示公式
  - 解释每个要素的含义
  - 提供示例说明

### 3.3 智能问答与引导
- **目标**：在用户困惑时提供及时帮助
- **功能**：
  - 概念提示（点击/悬停显示）
  - 选中文本进行问答
  - 语音或文字问答
  - 主动引导和思考提示
  - 提供大量示例

### 4.4 内容检索与推荐
- **目标**：从知识库中检索相关内容
- **数据源**：
  - `重要的事_价值观.csv` (100条)
  - `擅长的事_才能.csv` (100条)
  - `喜欢的事_热情.csv` (100条)
  - `question.md` (90个问题)
- **功能**：
  - 根据用户输入检索相似内容
  - 推荐相关示例
  - 提供参考问题

### 5.5 用户输入与记录
- **目标**：收集和展示用户的回答
- **功能**：
  - 文字输入（支持长文本）
  - 语音输入（可选）
  - 回答历史展示
  - 答案编辑和修改
  - 导出功能

## 二、需求确认（已明确）

### Q1: 用户身份管理 ✅
- **方案**：方案B - 用户注册登录
- **实现**：
  - 支持邮箱/手机号注册
  - 用户登录后保存所有探索记录
  - 支持多设备同步

### Q2: 用户信息收集 ✅
- **注册时收集**：
  - 性别
  - 年龄
  - 工作履历（详细）
    - 职业
    - 项目内容
    - 成就
    - 工作评价和感受
- **目的**：快速了解用户基本情况、能力、价值观，为后续引导做准备
- **设计**：工作履历为大量文本输入区域，支持多段经历

### Q3: 数据存储范围 ✅
- **存储内容**：
  - ✅ 用户输入输出（问答内容）
  - ✅ 对话引导过程
  - ✅ 用户选择的价值观/才能/兴趣
  - ✅ 最终得出的"想做的事"
  - ✅ 所有进度状态
  - ❌ 不存储智能体和tools的调用内容

### Q4: 语音功能 ✅
- **方案**：预留接口，通过配置控制
- **实现**：
  - 全局配置：`AUDIO_MODE=True/False`
  - `False`时：前端页面不可点击，但位置保留
  - `True`时：启用语音输入/输出功能
- **优先级**：P2，暂时不考虑实现

### Q5: 主动引导策略 ✅
- **触发条件**：
  - 用户超过10分钟无输入 → 主动提示
  - 用户表示需要安静 → 改为15分钟一次
  - 回答过短 → 被动引导
  - 回答模糊 → 被动引导
  - 卡在某个问题 → 被动引导
- **实现**：
  - 策略可配置，保留可选方法
  - 后期可优化配置
  - 页面上配置默认引导问题，用户可快速点选

### Q6: 多轮对话管理 ✅
- **方案**：
  - 维护多轮上下文
  - 可查看历史进度继续
  - 可重新开始
- **上下文管理**：
  - 保留上下文管理方法（重要）
  - 后期可大量增加算法
  - 目前：直接拼接上下文全部内容

### Q7: 数据导出格式 ✅
- **方案**：三选一
  - PDF报告
  - JSON数据
  - Markdown格式

### Q8: 部署环境 ✅
- **方案**：阿里云 + Docker容器化部署
- **要求**：支持HTTPS

### Q9: 性能要求 ✅
- **并发用户**：2-5人（低并发）
- **响应时间**：< 3秒
- **智能体响应**：< 5秒

## 三、功能优先级

### P0 (必须)
1. 基础流程引导（按流程图步骤）
2. 问题展示和回答收集
3. 文字问答功能
4. 基础数据存储
5. 内容检索（CSV和question.md）

### P1 (重要)
1. 概念提示和解释
2. 主动引导功能
3. 进度保存和恢复
4. 回答历史展示
5. 示例推荐

### P2 (可选)
1. 语音输入/输出
2. 数据导出
3. 用户注册登录
4. 可视化图表展示
5. 分享功能

## 四、用户体验要求

### 4.1 界面要求
- 简洁、现代、沉浸式
- 响应式设计（支持移动端）
- 清晰的视觉层次
- 友好的错误提示

### 4.2 交互要求
- 流畅的步骤切换
- 实时保存
- 快速响应
- 清晰的反馈

### 4.3 内容要求
- 精炼的指导性回答（不超过200字）
- 针对性强
- 提供具体示例
- 避免说教式语言

## 五、架构设计原则

### 5.1 模块化设计
- **原则**：所有框架和功能尽可能保留且解耦
- **模块划分**：
  - 大模型接入：`src/llmapi/api.py`
  - 前后端分离
  - API独立模块
  - 提示词压缩模块
  - 知识检索模块
  - 数据库模块（注册数据、历史数据、知识数据、向量知识检索）
  - 异步控制服务
  - 智能体框架
  - Tools模块
  - Actions模块
  - Skills模块
- **要求**：各模块清晰拆分，接口明确
